<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>CSV to JSON Converter</title>
    <meta
      name="description"
      content="Convert your Dynamo-style CSV exports into plain JSON in seconds. Normalizes attribute maps (S, N, BOOL) while preserving booleans and numbers."
    />
    <meta
      name="keywords"
      content="CSV,JSON,converter,DynamoDB,attribute map,S N M BOOL normalization"
    />
    <meta name="author" content="Jovylle B. Bermudez" />
    <style>
      :root {
        font-family: "Space Grotesk", system-ui, sans-serif;
        background-color: #04070f;
        color: #e2e8f0;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: #020617;
      }

      .page {
        max-width: 1100px;
        margin: 0 auto;
        padding: 48px 24px 72px;
      }

      .hero {
        margin-bottom: 32px;
      }

      .eyebrow {
        text-transform: uppercase;
        letter-spacing: 0.2em;
        font-size: 0.8rem;
        color: #94a3b8;
        margin: 0 0 10px;
      }

      .hero h1 {
        margin: 0;
        font-size: clamp(2.5rem, 4vw, 3.2rem);
        line-height: 1.1;
        color: #f8fafc;
      }

      .lede {
        margin-top: 12px;
        color: #cbd5f5;
        max-width: 720px;
        line-height: 1.6;
      }

      .hero-links {
        margin-top: 22px;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .hero-links a {
        color: #38bdf8;
        font-weight: 500;
        text-decoration: none;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 24px;
      }

      .card {
        border-radius: 20px;
        padding: 28px;
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.3);
        box-shadow: 0 20px 40px rgba(2, 6, 23, 0.65);
      }

      .converter label {
        font-size: 0.85rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: #94a3b8;
        display: block;
        margin-bottom: 6px;
      }

      textarea {
        width: 100%;
        min-height: 200px;
        border-radius: 14px;
        border: 1px solid rgba(226, 232, 240, 0.25);
        background: rgba(15, 23, 42, 0.9);
        color: #e2e8f0;
        font-family: "Space Grotesk", system-ui, monospace;
        padding: 14px;
        resize: vertical;
      }

      button {
        margin: 18px 0;
        width: 100%;
        padding: 16px;
        border-radius: 14px;
        border: none;
        font-size: 1rem;
        font-weight: 600;
        color: #fff;
        background: linear-gradient(135deg, #38bdf8, #6366f1);
        cursor: pointer;
      }

      .output-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      button.secondary {
        margin: 0;
        width: auto;
        padding: 10px 18px;
        background: rgba(148, 163, 184, 0.25);
        border: 1px solid rgba(148, 163, 184, 0.4);
        color: #e2e8f0;
      }

      button.secondary:hover {
        background: rgba(148, 163, 184, 0.4);
      }

      .notes h2 {
        margin-top: 0;
        font-size: 1.5rem;
        color: #f8fafc;
      }

      .notes p {
        color: #cbd5f5;
        line-height: 1.6;
      }

      .notes ul {
        padding-left: 20px;
        color: #94a3b8;
        line-height: 1.6;
      }

      .notes footer {
        margin-top: 18px;
        color: #94a3b8;
        font-size: 0.9rem;
      }

      .notes a {
        color: #38bdf8;
      }

      code {
        background: rgba(59, 130, 246, 0.15);
        padding: 2px 6px;
        border-radius: 6px;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <main class="page">
      <header class="hero">
        <p class="eyebrow">Dynamo Attribute CSV Normalizer</p>
        <h1>Clean JSON from Dynamo-style exports</h1>
        <p class="lede">
          Drop CSV files that still wrap values in Dynamo attribute maps (S, N, BOOL,
          M, L, etc.) and get a ready-to-use JSON payload. The page unwraps the
          metadata so downstream scripts, dashboards, or automations can consume
          what you just uploaded.
        </p>
        <div class="hero-links">
          <a href="../">← Back to hub</a>
          <a href="https://github.com/jovylle/wanabusful/tree/main/csv-to-json" target="_blank" rel="noreferrer">View source</a>
          <a href="https://jovylle.com" target="_blank" rel="noreferrer">Visit jovylle.com</a>
        </div>
      </header>

      <section class="grid">
        <div class="card converter">
          <div class="field">
            <label for="csv">Paste Dynamo-exported CSV</label>
            <textarea id="csv" placeholder="clientId,clientName,..."></textarea>
          </div>

          <button onclick="convert()">Normalize to JSON</button>

          <div class="field">
            <label for="json">Plain JSON output</label>
            <textarea id="json" readonly></textarea>
            <div class="output-actions">
              <button type="button" onclick="copyJson()" class="secondary">Copy JSON</button>
              <button type="button" onclick="downloadJson()" class="secondary">Download .json</button>
            </div>
          </div>
        </div>

        <aside class="card notes">
          <h2>Why this works</h2>
          <p>
            DynamoDB csv exports wrap every field with metadata like
            `{"S":"value"}` or `{"M":{...}}`. This parser strips those wrappers,
            keeps booleans and numbers typed, and leaves other strings untouched.
          </p>
          <ul>
            <li>Handles maps (`M`), lists (`L`), and nested attribute sets.</li>
            <li>Parses numeric strings into numbers; empty cells become `null`.</li>
            <li>Gracefully parses embedded JSON inside cells before normalizing.</li>
          </ul>
          <p>
            Deployed via Netlify—pushes to <code>master</code> rebuild automatically.
          </p>
          <footer>
            Built by <a href="https://jovylle.com" target="_blank" rel="noreferrer">Jovylle Bermudez</a>
          </footer>
        </aside>
      </section>
    </main>

    <script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
  function convert() {
    const input = document.getElementById("csv").value.trim();
    if (!input) return;

    const parsed = Papa.parse(input, {
      header: true,
      skipEmptyLines: true,
    });

    const data = parsed.data.map(row => {
      const normalized = {};

      Object.entries(row).forEach(([key, value]) => {
        normalized[key] = normalizeCell(value);
      });

      return normalized;
    });

    document.getElementById("json").value =
      JSON.stringify(data, null, 2);
  }

  function copyJson() {
    const jsonEl = document.getElementById("json");
    const val = jsonEl.value.trim();
    if (!val) return;
    navigator.clipboard.writeText(val).then(
      () => { if (window.alert) window.alert("JSON copied to clipboard."); },
      () => { if (window.alert) window.alert("Copy failed."); }
    );
  }

  function downloadJson() {
    const val = document.getElementById("json").value.trim();
    if (!val) return;
    const blob = new Blob([val], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "normalized.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  function normalizeCell(value) {
    if (value == null) return null;
    const trimmed = value.toString().trim();
    if (!trimmed) return null;

    const lowered = trimmed.toLowerCase();
    if (lowered === "true") return true;
    if (lowered === "false") return false;
    if (isNumeric(trimmed)) return Number(trimmed);

    if (trimmed.startsWith("{") || trimmed.startsWith("[")) {
      const parsed = tryParseJson(trimmed);
      if (parsed !== undefined) return normalizeParsed(parsed);
    }

    return trimmed;
  }

  function isNumeric(value) {
    return !Number.isNaN(Number(value)) && /^[+-]?\d+(\.\d+)?$/.test(value);
  }

  function tryParseJson(value) {
    try {
      return JSON.parse(value);
    } catch {
      return undefined;
    }
  }

  function normalizeParsed(parsedValue) {
    if (Array.isArray(parsedValue)) {
      return parsedValue.map(normalizeParsed);
    }

    if (parsedValue && typeof parsedValue === "object") {
      const keys = Object.keys(parsedValue);
      if (keys.length === 1) {
        const [key] = keys;
        switch (key) {
          case "S":
            return parsedValue.S;
          case "N":
            return Number(parsedValue.N);
          case "BOOL":
            return Boolean(parsedValue.BOOL);
          case "NULL":
            return null;
          case "M":
            return normalizeParsed(parsedValue.M);
          case "L":
            return parsedValue.L.map(normalizeParsed);
          case "SS":
          case "NS":
          case "BS":
            return parsedValue[key];
        }
      }

      const normalized = {};
      keys.forEach(key => {
        normalized[key] = normalizeParsed(parsedValue[key]);
      });
      return normalized;
    }

    return parsedValue;
  }
  </script>

  </body>
</html>
